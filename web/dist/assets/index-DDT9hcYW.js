import{j as t,I as da,c as ct,d as ma,e as ha,f as ga,g as pa,h as xa,i as ba,k as xe,l as fa,m as ut,M as Ca,F as L,S as dt,C as D,A as mt,T as va,n as ht,o as ya,p as gt,E as Z,q as ja,r as pt,s as ka,t as Fa,P as Da}from"./semi-ui-CgLMsDGp.js";import{r as l,u as wa}from"./react-core-DtMAePju.js";import{l as xt,V as z,a as be}from"./visactor-C6yu58Ir.js";import{I as Y,a as J}from"./IllustrationConstruction-h2fiJesH.js";import{aL as Ee,aM as Ea,aN as Na,aO as Ta,aP as X,aQ as fe,aR as Ce,aS as y,aT as _a,aU as Sa,aV as ve,aW as Ma,aX as Ba,A as ye,s as je,aY as ke,aZ as Aa,a_ as Ia,a$ as $a,b0 as Ra,b1 as Pa,b2 as qa}from"./index-0A-PSN5a.js";import{u as Ha}from"./i18n-BpL67IU5.js";import"./tools-Bi2Pi1s6.js";import"./react-components-XvIrFW7f.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],za=Ee("chart-pie",La);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],Ua=Ee("server",Qa);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Va=Ee("wallet",Oa),bt="Inter,-apple-system,BlinkMacSystemFont,Segoe UI,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Helvetica Neue,Helvetica,Arial,sans-serif",De="theme-mode",ft=(c,n,u)=>{const r=c&&getComputedStyle(document.body).getPropertyValue(c)||n;return r&&!isNaN(r[0])?`rgba(${r})`:r},Wa=(c,n,u)=>{new MutationObserver(r=>{r.forEach(d=>{d.attributeName===n&&u(d)})}).observe(c,{attributes:!0})},Ga=(c,n,u,r)=>n.map((d,o)=>{const{scheme:b}=u[o];return Object.assign(Object.assign({},d),{scheme:d.scheme.map((j,k)=>ft(typeof j=="object"?j[c]:j,b==null?void 0:b[k]))})}),Ka=(c,n,u,r)=>{const d={};return Object.keys(n).forEach(o=>{const b=typeof n[o]=="object"?n[o][c]:n[o];d[o]=ft(b,u[o])}),d},Ct=()=>document.body.hasAttribute(De)&&document.body.getAttribute(De)==="dark"?"dark":"light",Za=c=>`semiDesign${c[0].toUpperCase()}${c.slice(1)}`,Ya=c=>{new MutationObserver(n=>{n.forEach(u=>{var r;if(u.addedNodes.length===1){const d=u.addedNodes[0];d.tagName==="LINK"&&((r=d.getAttribute)===null||r===void 0?void 0:r.call(d,"semi-theme-switcher"))==="true"&&c(u,d)}})}).observe(document.body,{childList:!0})},Ja={default:{dataScheme:xt.colorScheme.default.dataScheme,palette:{backgroundColor:"#16161a",borderColor:"rgba(255,255,255,0.08)",shadowColor:"rgba(0,0,0,0.25)",hoverBackgroundColor:"rgba(255,255,255,0.12)",sliderRailColor:"rgba(255,255,255,0.12)",sliderHandleColor:"#e4e7f5",sliderTrackColor:"rgba(84,169,255,1)",popupBackgroundColor:"#43444a",primaryFontColor:"rgba(249,249,249,1)",secondaryFontColor:"rgba(249,249,249,0.8)",tertiaryFontColor:"rgba(249,249,249,0.6)",axisLabelFontColor:"rgba(249,249,249,0.6)",disableFontColor:"rgba(249,249,249,0.35)",axisMarkerFontColor:"#16161a",axisGridColor:"rgba(255,255,255,0.08)",axisDomainColor:"rgba(255,255,255,0.08)",dataZoomHandleStrokeColor:"rgba(46,50,56,0.13)",dataZoomChartColor:"rgba(255,255,255,0.16)",playerControllerColor:"rgba(84,169,255,1)",axisMarkerBackgroundColor:"rgba(249,249,249,1)",markLabelBackgroundColor:"rgba(255,255,255,0.08)",markLineStrokeColor:"rgba(249,249,249,0.8)",dangerColor:"rgba(252,114,90,1)",warningColor:"rgba(255,174,67,1)",successColor:"rgba(93,194,100,1)",infoColor:"rgba(84,169,255,1)"}}},Xa={name:"semiDesignDark",description:"Semi Design - dark",type:"dark",fontFamily:bt,colorScheme:Ja},es={default:{dataScheme:xt.colorScheme.default.dataScheme,palette:{backgroundColor:"rgba(255,255,255,1)",borderColor:"rgba(28,31,35,0.08)",shadowColor:"rgba(0,0,0,0.1)",hoverBackgroundColor:"rgba(46,50,56,0.05)",sliderRailColor:"rgba(46,50,56,0.05)",sliderHandleColor:"rgba(255,255,255,1)",sliderTrackColor:"rgba(0,100,250,1)",popupBackgroundColor:"rgba(255,255,255,1)",primaryFontColor:"rgba(28,31,35,1)",secondaryFontColor:"rgba(28,31,35,0.8)",tertiaryFontColor:"rgba(28,31,35,0.62)",axisLabelFontColor:"rgba(28,31,35,0.62)",disableFontColor:"rgba(28,31,35,0.35)",axisMarkerFontColor:"rgba(255,255,255,1)",axisGridColor:"rgba(28,31,35,0.08)",axisDomainColor:"rgba(28,31,35,0.15)",dataZoomHandleStrokeColor:"rgba(46,50,56,0.13)",dataZoomChartColor:"rgba(46,50,56,0.09)",playerControllerColor:"rgba(0,100,250,1)",axisMarkerBackgroundColor:"rgba(28,31,35,1)",markLabelBackgroundColor:"rgba(28,31,35,0.08)",markLineStrokeColor:"rgba(28,31,35,0.8)",dangerColor:"rgba(249,57,32,1)",warningColor:"rgba(252,136,0,1)",successColor:"rgba(59,179,70,1)",infoColor:"rgba(0,100,250,1)"}}},ts={name:"semiDesignLight",description:"Semi Design - light",type:"light",fontFamily:bt,colorScheme:es},as={backgroundColor:"--semi-color-bg-0",borderColor:"--semi-color-border",hoverBackgroundColor:"--semi-color-fill-0",sliderRailColor:"--semi-color-fill-0",sliderHandleColor:"--semi-white",sliderTrackColor:"--semi-color-primary",popupBackgroundColor:"--semi-color-bg-3",primaryFontColor:"--semi-color-text-0",secondaryFontColor:"--semi-color-text-1",tertiaryFontColor:"--semi-color-text-2",axisLabelFontColor:"--semi-color-text-0",disableFontColor:"--semi-color-disabled-text",axisMarkerFontColor:"--semi-color-bg-0",axisGridColor:"--semi-color-border",axisDomainColor:{light:"--semi-grey-9",dark:"--semi-color-border"},dataZoomHandleStrokeColor:{light:"--semi-color-fill-2"},dataZoomChartColor:"--semi-color-fill-1",playerControllerColor:"--semi-color-primary",axisMarkerBackgroundColor:"--semi-color-text-0",markLabelBackgroundColor:"--semi-color-border",markLineStrokeColor:"--semi-color-text-1",dangerColor:"--semi-color-danger",warningColor:"--semi-color-warning",successColor:"--semi-color-success",infoColor:"--semi-color-info"},ss=[{maxDomainLength:10,scheme:["--semi-color-data-0","--semi-color-data-2","--semi-color-data-4","--semi-color-data-6","--semi-color-data-8","--semi-color-data-10","--semi-color-data-12","--semi-color-data-14","--semi-color-data-16","--semi-color-data-18"]},{scheme:["--semi-color-data-0","--semi-color-data-1","--semi-color-data-2","--semi-color-data-3","--semi-color-data-4","--semi-color-data-5","--semi-color-data-6","--semi-color-data-7","--semi-color-data-8","--semi-color-data-9","--semi-color-data-10","--semi-color-data-11","--semi-color-data-12","--semi-color-data-13","--semi-color-data-14","--semi-color-data-15","--semi-color-data-16","--semi-color-data-17","--semi-color-data-18","--semi-color-data-19"]}],os={light:ts,dark:Xa},we=(c,n)=>{const u=os[c],{dataScheme:r,palette:d}=u.colorScheme.default,o={default:{dataScheme:Ga(c,ss,r),palette:Ka(c,as,d)}};return Object.assign(Object.assign({},u),{colorScheme:o})},ls=c=>{const{defaultMode:n,isWatchingMode:u=!0,isWatchingThemeSwitch:r=!1}=c??{};Fe(!1,n),u&&Wa(document.body,De,()=>Fe()),r&&Ya(()=>{const d=Ct(),o=JSON.stringify(we(d).colorScheme);let b=0;const j=setInterval(()=>{const k=we(d);(b>50||o!==JSON.stringify(k.colorScheme))&&(Fe(!0,d,k),clearInterval(j)),b++},100)})},Fe=(c,n,u)=>{n||(n=Ct());const r=Za(n);(c||z.ThemeManager.getCurrentTheme()!==r)&&(c&&z.ThemeManager.removeTheme(r),z.ThemeManager.themeExist(r)||z.ThemeManager.registerTheme(r,u??we(n)),z.ThemeManager.setCurrentTheme(r))},bs=c=>{var Ze,Ye,Je,Xe,et,tt,at,st,ot,lt,rt;const[n,u]=l.useContext(Ea),[r,d]=l.useContext(Na),{t:o}=Ha(),b=wa(),j=l.useRef(),k=l.useRef(!1),ee=l.useRef(null),te={mode:"desktop-browser"},w={shadows:"always",bordered:!1,headerLine:!0},vt={className:"w-full mb-2 !rounded-lg",size:"large"},Ne="text-white hover:bg-opacity-80 !rounded-full",Q="flex items-center gap-2";let Te=new Date;const ae=Ta(),se=l.useCallback(()=>localStorage.getItem("data_export_default_time")||"hour",[]),U=l.useCallback((e,a=!1)=>{const s={hour:a?3600:60,day:a?86400:1440,week:a?604800:10080};return s[e]||s.hour},[]),yt=l.useCallback(()=>{const e=se(),a=new Date().getTime()/1e3;switch(e){case"hour":return X(a-86400);case"week":return X(a-86400*30);default:return X(a-86400*7)}},[se]),E=l.useCallback((e,a,s)=>{e.has(a)||e.set(a,0),e.set(a,e.get(a)+s)},[]),_e=l.useCallback((e,...a)=>{a.forEach(s=>{s.has(e)||s.set(e,0)})},[]),oe=l.useCallback((e,a,s,i,h)=>{e(m=>({...m,data:[{id:h,values:a}],title:{...m.title,subtext:s},color:{specified:i}}))},[]),$=l.useCallback((e,a)=>t.jsxs("div",{className:Q,children:[t.jsx(e,{size:16}),a]}),[]),O=l.useCallback((e,a)=>t.jsx(e,{...vt,...a}),[]),jt=l.useMemo(()=>[{label:o("小时"),value:"hour"},{label:o("天"),value:"day"},{label:o("周"),value:"week"}],[o]),[kt,Ft]=l.useState({username:"",token_name:"",model_name:"",start_timestamp:yt(),end_timestamp:X(Te.getTime()/1e3+3600),channel:"",data_export_default_time:""}),[x,Dt]=l.useState(se()),[Se,Me]=l.useState(!1),[rs,wt]=l.useState([]),[le,Et]=l.useState(0),[N,Nt]=l.useState(0),[R,Tt]=l.useState(0),[_t,St]=l.useState([{type:"null",value:"0"}]),[Mt,Bt]=l.useState([]),[Be,At]=l.useState({}),[Ae,It]=l.useState("1"),[$t,Rt]=l.useState(!1),[Pt,re]=l.useState(!1),[T,qt]=l.useState({balance:[],usedQuota:[],requestCount:[],times:[],consumeQuota:[],tokens:[],rpm:[],tpm:[]}),ne=l.useRef(null),ie=l.useRef(null),ce=l.useRef(null),[Ht,Ie]=l.useState(!1),[Lt,$e]=l.useState(!1),[zt,Re]=l.useState(!1),[P,Qt]=l.useState([]),[Pe,qe]=l.useState(!1),{username:ue,model_name:ns,start_timestamp:_,end_timestamp:S,channel:is}=kt,[Ut,Ot]=l.useState({type:"pie",data:[{id:"id0",values:_t}],outerRadius:.8,innerRadius:.5,padAngle:.6,valueField:"value",categoryField:"type",pie:{style:{cornerRadius:10},state:{hover:{outerRadius:.85,stroke:"#000",lineWidth:1},selected:{outerRadius:.85,stroke:"#000",lineWidth:1}}},title:{visible:!0,text:o("模型调用次数占比"),subtext:`${o("总计")}：${fe(R)}`},legends:{visible:!0,orient:"left"},label:{visible:!0},tooltip:{mark:{content:[{key:e=>e.type,value:e=>fe(e.value)}]}},color:{specified:Ce}}),[Vt,Wt]=l.useState({type:"bar",data:[{id:"barData",values:Mt}],xField:"Time",yField:"Usage",seriesField:"Model",stack:!0,legends:{visible:!0,selectMode:"single"},title:{visible:!0,text:o("模型消耗分布"),subtext:`${o("总计")}：${y(le,2)}`},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},tooltip:{mark:{content:[{key:e=>e.Model,value:e=>y(e.rawQuota||0,4)}]},dimension:{content:[{key:e=>e.Model,value:e=>e.rawQuota||0}],updateContent:e=>{e.sort((s,i)=>i.value-s.value);let a=0;for(let s=0;s<e.length;s++){if(e[s].key=="其他")continue;let i=parseFloat(e[s].value);isNaN(i)&&(i=0),e[s].datum&&e[s].datum.TimeSum&&(a=e[s].datum.TimeSum),e[s].value=y(i,4)}return e.unshift({key:o("总计"),value:y(a,4)}),e}}},color:{specified:Ce}}),de=l.useMemo(()=>{const e=(Date.parse(S)-Date.parse(_))/6e4,a=(R/e).toFixed(3),s=isNaN(N/e)?"0":(N/e).toFixed(3);return{avgRPM:a,avgTPM:s,timeDiff:e}},[R,N,S,_]),Gt=l.useMemo(()=>{var i;const e=new Date().getHours();let a="";e>=5&&e<12?a=o("早上好"):e>=12&&e<14?a=o("中午好"):e>=14&&e<18?a=o("下午好"):a=o("晚上好");const s=((i=n==null?void 0:n.user)==null?void 0:i.username)||"";return`👋${a}，${s}`},[o,(Ze=n==null?void 0:n.user)==null?void 0:Ze.username]),Kt=l.useCallback((e,a)=>({type:"line",data:[{id:"trend",values:e.map((s,i)=>({x:i,y:s}))}],xField:"x",yField:"y",height:40,width:100,axes:[{orient:"bottom",visible:!1},{orient:"left",visible:!1}],padding:0,autoFit:!1,legends:{visible:!1},tooltip:{visible:!1},crosshair:{visible:!1},line:{style:{stroke:a,lineWidth:2}},point:{visible:!1},background:{fill:"transparent"}}),[]),Zt=l.useMemo(()=>{var e,a,s;return[{title:$(Va,o("账户数据")),color:"bg-blue-50",items:[{title:o("当前余额"),value:y((e=n==null?void 0:n.user)==null?void 0:e.quota),icon:t.jsx(da,{size:"large"}),avatarColor:"blue",onClick:()=>b("/console/topup"),trendData:[],trendColor:"#3b82f6"},{title:o("历史消耗"),value:y((a=n==null?void 0:n.user)==null?void 0:a.used_quota),icon:t.jsx(ct,{size:"large"}),avatarColor:"purple",trendData:[],trendColor:"#8b5cf6"}]},{title:$(_a,o("使用统计")),color:"bg-green-50",items:[{title:o("请求次数"),value:(s=n.user)==null?void 0:s.request_count,icon:t.jsx(ma,{size:"large"}),avatarColor:"green",trendData:[],trendColor:"#10b981"},{title:o("统计次数"),value:R,icon:t.jsx(ha,{size:"large"}),avatarColor:"cyan",trendData:T.times,trendColor:"#06b6d4"}]},{title:$(Sa,o("资源消耗")),color:"bg-yellow-50",items:[{title:o("统计额度"),value:y(le),icon:t.jsx(ga,{size:"large"}),avatarColor:"yellow",trendData:T.consumeQuota,trendColor:"#f59e0b"},{title:o("统计Tokens"),value:isNaN(N)?0:N,icon:t.jsx(pa,{size:"large"}),avatarColor:"pink",trendData:T.tokens,trendColor:"#ec4899"}]},{title:$(ve,o("性能指标")),color:"bg-indigo-50",items:[{title:o("平均RPM"),value:de.avgRPM,icon:t.jsx(xa,{size:"large"}),avatarColor:"indigo",trendData:T.rpm,trendColor:"#6366f1"},{title:o("平均TPM"),value:de.avgTPM,icon:t.jsx(ba,{size:"large"}),avatarColor:"orange",trendData:T.tpm,trendColor:"#f97316"}]}]},[$,o,(Ye=n==null?void 0:n.user)==null?void 0:Ye.quota,(Je=n==null?void 0:n.user)==null?void 0:Je.used_quota,(Xe=n==null?void 0:n.user)==null?void 0:Xe.request_count,R,le,N,T,de,b]),Yt=l.useCallback(async e=>{await Ma(e)&&Ba(o("复制成功"))},[o]),Jt=l.useCallback(e=>{const s=`https://www.tcptest.cn/http/${encodeURIComponent(e)}`;window.open(s,"_blank")},[]),V=l.useCallback((e,a)=>{if(a==="data_export_default_time"){Dt(e);return}Ft(s=>({...s,[a]:e}))},[]),W=l.useCallback(async()=>{Me(!0);try{let e="",a=Date.parse(_)/1e3,s=Date.parse(S)/1e3;ae?e=`/api/data/?username=${ue}&start_timestamp=${a}&end_timestamp=${s}&default_time=${x}`:e=`/api/data/self/?start_timestamp=${a}&end_timestamp=${s}&default_time=${x}`;const i=await ye.get(e),{success:h,message:m,data:g}=i.data;h?(wt(g),g.length===0&&g.push({count:0,model_name:"无数据",quota:0,created_at:Te.getTime()/1e3}),g.sort((B,A)=>B.created_at-A.created_at),la(g)):je(m)}finally{Me(!1)}},[_,S,ue,x,ae]),q=l.useCallback(async()=>{qe(!0);try{const e=await ye.get("/api/uptime/status"),{success:a,message:s,data:i}=e.data;a?Qt(i||[]):je(s)}catch(e){console.error(e)}finally{qe(!1)}},[]),me=l.useCallback(async()=>{await Promise.all([W(),q()])},[W,q]),Xt=l.useCallback(()=>{me(),re(!1)},[me]),ea=l.useCallback(async()=>{await W(),await q()},[W,q]),ta=l.useCallback(()=>{re(!0)},[]),aa=l.useCallback(()=>{re(!1)},[]),He=()=>{if(ee.current){const e=ee.current,a=e.scrollHeight>e.clientHeight,s=e.scrollTop+e.clientHeight>=e.scrollHeight-5;Rt(a&&!s)}},sa=()=>{He()},G=(e,a)=>{if(e.current){const s=e.current,i=s.scrollHeight>s.clientHeight,h=s.scrollTop+s.clientHeight>=s.scrollHeight-5;a(i&&!h)}},he=(e,a)=>{G(e,a)};l.useEffect(()=>{const e=setTimeout(()=>{He(),G(ne,Ie),G(ie,$e),G(ce,Re)},100);return()=>clearTimeout(e)},[P]);const oa=async()=>{let e=await ye.get("/api/user/self");const{success:a,message:s,data:i}=e.data;a?u({type:"login",payload:i}):je(s)},Le=l.useCallback(e=>{const a={totalQuota:0,totalTimes:0,totalTokens:0,uniqueModels:new Set,timePoints:[],timeQuotaMap:new Map,timeTokensMap:new Map,timeCountMap:new Map};return e.forEach(s=>{a.uniqueModels.add(s.model_name),a.totalTokens+=s.token_used,a.totalQuota+=s.quota,a.totalTimes+=s.count;const i=ke(s.created_at,x);a.timePoints.includes(i)||a.timePoints.push(i),_e(i,a.timeQuotaMap,a.timeTokensMap,a.timeCountMap),E(a.timeQuotaMap,i,s.quota),E(a.timeTokensMap,i,s.token_used),E(a.timeCountMap,i,s.count)}),a.timePoints.sort(),a},[x,_e,E]),ze=l.useCallback((e,a,s,i)=>{const h=e.map(f=>a.get(f)||0),m=e.map(f=>s.get(f)||0),g=e.map(f=>i.get(f)||0),B=[],A=[];if(e.length>=2){const f=U(x);for(let I=0;I<e.length;I++)B.push(i.get(e[I])/f),A.push(s.get(e[I])/f)}return{balance:[],usedQuota:[],requestCount:[],times:g,consumeQuota:h,tokens:m,rpm:B,tpm:A}},[x,U]),Qe=l.useCallback(e=>{const a={};return Array.from(e).forEach(s=>{a[s]=Ce[s]||Be[s]||Aa(s)}),a},[Be]),Ue=l.useCallback(e=>{const a=new Map;return e.forEach(s=>{const i=ke(s.created_at,x),h=s.model_name,m=`${i}-${h}`;a.has(m)||a.set(m,{time:i,model:h,quota:0,count:0});const g=a.get(m);g.quota+=s.quota,g.count+=s.count}),a},[x]),Oe=l.useCallback((e,a)=>{let s=Array.from(new Set([...e.values()].map(i=>i.time)));if(s.length<7){const i=Math.max(...a.map(m=>m.created_at)),h=U(x,!0);s=Array.from({length:7},(m,g)=>ke(i-(6-g)*h,x))}return s},[x,U]),la=l.useCallback(e=>{const a=Le(e),{totalQuota:s,totalTimes:i,totalTokens:h,uniqueModels:m,timePoints:g,timeQuotaMap:B,timeTokensMap:A,timeCountMap:f}=a,I=ze(g,B,A,f);qt(I);const ge=Qe(m);At(ge);const pe=Ue(e),nt=new Map;for(let[C,p]of pe)E(nt,p.model,p.count);const it=Array.from(nt).map(([C,p])=>({type:C,value:p})).sort((C,p)=>p.value-C.value),ca=Oe(pe,e);let K=[];ca.forEach(C=>{let p=Array.from(m).map(v=>{const H=`${C}-${v}`,F=pe.get(H);return{Time:C,Model:v,rawQuota:(F==null?void 0:F.quota)||0,Usage:F!=null&&F.quota?Ia(F.quota,4):0}});const ua=p.reduce((v,H)=>v+H.rawQuota,0);p.sort((v,H)=>H.rawQuota-v.rawQuota),p=p.map(v=>({...v,TimeSum:ua})),K.push(...p)}),K.sort((C,p)=>C.Time.localeCompare(p.Time)),oe(Ot,it,`${o("总计")}：${fe(i)}`,ge,"id0"),oe(Wt,K,`${o("总计")}：${y(s,2)}`,ge,"barData"),St(it),Bt(K),Et(s),Tt(i),Nt(h)},[Le,ze,Qe,Ue,Oe,oe,E,o]),ra=l.useMemo(()=>[{color:"grey",label:o("默认"),type:"default"},{color:"blue",label:o("进行中"),type:"ongoing"},{color:"green",label:o("成功"),type:"success"},{color:"orange",label:o("警告"),type:"warning"},{color:"red",label:o("异常"),type:"error"}],[o]),M=l.useMemo(()=>({1:{color:"#10b981",label:o("正常"),text:o("可用率")},0:{color:"#ef4444",label:o("异常"),text:o("有异常")},2:{color:"#f59e0b",label:o("高延迟"),text:o("高延迟")},3:{color:"#3b82f6",label:o("维护中"),text:o("维护中")}}),[o]),na=l.useMemo(()=>Object.entries(M).map(([e,a])=>({status:Number(e),color:a.color,label:a.label})),[M]),Ve=l.useCallback(e=>{var a;return((a=M[e])==null?void 0:a.color)||"#8b9aa7"},[M]),ia=l.useCallback(e=>{var a;return((a=M[e])==null?void 0:a.text)||o("未知")},[M,o]),We=l.useMemo(()=>{var e;return((e=r==null?void 0:r.status)==null?void 0:e.api_info)||[]},[(et=r==null?void 0:r.status)==null?void 0:et.api_info]),Ge=l.useMemo(()=>{var a;return(((a=r==null?void 0:r.status)==null?void 0:a.announcements)||[]).map(s=>({...s,time:$a(s.publishDate)}))},[(tt=r==null?void 0:r.status)==null?void 0:tt.announcements]),Ke=l.useMemo(()=>{var e;return((e=r==null?void 0:r.status)==null?void 0:e.faq)||[]},[(at=r==null?void 0:r.status)==null?void 0:at.faq]);return l.useEffect(()=>{oa(),k.current||(ls({isWatchingThemeSwitch:!0}),k.current=!0,ea())},[]),t.jsxs("div",{className:"bg-gray-50 h-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:Gt}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx(xe,{icon:t.jsx(fa,{}),onClick:ta,className:`bg-green-500 hover:bg-green-600 ${Ne}`}),t.jsx(xe,{icon:t.jsx(ut,{}),onClick:me,loading:Se,className:`bg-blue-500 hover:bg-blue-600 ${Ne}`})]})]}),t.jsx(Ca,{title:o("搜索条件"),visible:Pt,onOk:Xt,onCancel:aa,closeOnEsc:!0,size:Ra()?"full-width":"small",centered:!0,children:t.jsxs(L,{ref:j,layout:"vertical",className:"w-full",children:[O(L.DatePicker,{field:"start_timestamp",label:o("起始时间"),initValue:_,value:_,type:"dateTime",name:"start_timestamp",onChange:e=>V(e,"start_timestamp")}),O(L.DatePicker,{field:"end_timestamp",label:o("结束时间"),initValue:S,value:S,type:"dateTime",name:"end_timestamp",onChange:e=>V(e,"end_timestamp")}),O(L.Select,{field:"data_export_default_time",label:o("时间粒度"),initValue:x,placeholder:o("时间粒度"),name:"data_export_default_time",optionList:jt,onChange:e=>V(e,"data_export_default_time")}),ae&&O(L.Input,{field:"username",label:o("用户名称"),value:ue,placeholder:o("可选值"),name:"username",onChange:e=>V(e,"username")})]})}),t.jsxs(dt,{spinning:Se,children:[t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Zt.map((e,a)=>t.jsx(D,{...w,className:`${e.color} border-0 !rounded-2xl w-full`,title:e.title,children:t.jsx("div",{className:"space-y-4",children:e.items.map((s,i)=>t.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:s.onClick,children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(mt,{className:"mr-3",size:"small",color:s.avatarColor,children:s.icon}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500",children:s.title}),t.jsx("div",{className:"text-lg font-semibold",children:s.value})]})]}),s.trendData&&s.trendData.length>0&&t.jsx("div",{className:"w-24 h-10",children:t.jsx(be,{spec:Kt(s.trendData,s.trendColor),option:te})})]},i))})},a))})}),t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:`grid grid-cols-1 gap-4 ${(st=r==null?void 0:r.status)!=null&&st.self_use_mode_enabled?"":"lg:grid-cols-4"}`,children:[t.jsx(D,{...w,className:`shadow-sm !rounded-2xl ${(ot=r==null?void 0:r.status)!=null&&ot.self_use_mode_enabled?"":"lg:col-span-3"}`,title:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between w-full gap-3",children:[t.jsxs("div",{className:Q,children:[t.jsx(za,{size:16}),o("模型数据分析")]}),t.jsxs(va,{type:"button",activeKey:Ae,onChange:It,children:[t.jsx(ht,{tab:t.jsxs("span",{children:[t.jsx(ct,{}),o("消耗分布")]}),itemKey:"1"}),t.jsx(ht,{tab:t.jsxs("span",{children:[t.jsx(ya,{}),o("调用次数分布")]}),itemKey:"2"})]})]}),children:t.jsx("div",{style:{height:400},children:Ae==="1"?t.jsx(be,{spec:Vt,option:te}):t.jsx(be,{spec:Ut,option:te})})}),!((lt=r==null?void 0:r.status)!=null&&lt.self_use_mode_enabled)&&t.jsx(D,{...w,className:"bg-gray-50 border-0 !rounded-2xl",title:t.jsxs("div",{className:Q,children:[t.jsx(Ua,{size:16}),o("API信息")]}),children:t.jsxs("div",{className:"card-content-container",children:[t.jsx("div",{ref:ee,className:"space-y-3 max-h-96 overflow-y-auto card-content-scroll",onScroll:sa,children:We.length>0?We.map(e=>t.jsxs("div",{className:"flex p-2 hover:bg-white rounded-lg transition-colors cursor-pointer",children:[t.jsx("div",{className:"flex-shrink-0 mr-3",children:t.jsx(mt,{size:"extra-small",color:e.color,children:e.route.substring(0,2)})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1 !font-bold flex items-center gap-2",children:[t.jsx(gt,{prefixIcon:t.jsx(ve,{size:12}),size:"small",color:"white",shape:"circle",onClick:()=>Jt(e.url),className:"cursor-pointer hover:opacity-80 text-xs",children:o("测速")}),e.route]}),t.jsx("div",{className:"!text-semi-color-primary break-all cursor-pointer hover:underline mb-1",onClick:()=>Yt(e.url),children:e.url}),t.jsx("div",{className:"text-gray-500",children:e.description})]})]},e.id)):t.jsx("div",{className:"flex justify-center items-center py-8",children:t.jsx(Z,{image:t.jsx(Y,{style:{width:80,height:80}}),darkModeImage:t.jsx(J,{style:{width:80,height:80}}),title:o("暂无API信息"),description:o("请联系管理员在系统设置中配置API信息"),style:{padding:"12px"}})})}),t.jsx("div",{className:"card-content-fade-indicator",style:{opacity:$t?1:0}})]})})]})}),!((rt=r==null?void 0:r.status)!=null&&rt.self_use_mode_enabled)&&t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[t.jsx(D,{...w,className:"shadow-sm !rounded-2xl lg:col-span-2",title:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-2 w-full",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Pa,{size:16}),o("系统公告"),t.jsx(gt,{size:"small",color:"grey",shape:"circle",children:o("显示最新20条")})]}),t.jsx("div",{className:"flex flex-wrap gap-3 text-xs",children:ra.map((e,a)=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color==="grey"?"#8b9aa7":e.color==="blue"?"#3b82f6":e.color==="green"?"#10b981":e.color==="orange"?"#f59e0b":e.color==="red"?"#ef4444":"#8b9aa7"}}),t.jsx("span",{className:"text-gray-600",children:e.label})]},a))})]}),children:t.jsxs("div",{className:"card-content-container",children:[t.jsx("div",{ref:ne,className:"p-2 max-h-96 overflow-y-auto card-content-scroll",onScroll:()=>he(ne,Ie),children:Ge.length>0?t.jsx(ja,{mode:"alternate",dataSource:Ge}):t.jsx("div",{className:"flex justify-center items-center py-8",children:t.jsx(Z,{image:t.jsx(Y,{style:{width:80,height:80}}),darkModeImage:t.jsx(J,{style:{width:80,height:80}}),title:o("暂无系统公告"),description:o("请联系管理员在系统设置中配置公告信息"),style:{padding:"12px"}})})}),t.jsx("div",{className:"card-content-fade-indicator",style:{opacity:Ht?1:0}})]})}),t.jsx(D,{...w,className:"shadow-sm !rounded-2xl lg:col-span-1",title:t.jsxs("div",{className:Q,children:[t.jsx(qa,{size:16}),o("常见问答")]}),children:t.jsxs("div",{className:"card-content-container",children:[t.jsx("div",{ref:ie,className:"p-2 max-h-96 overflow-y-auto card-content-scroll",onScroll:()=>he(ie,$e),children:Ke.length>0?t.jsx(pt,{accordion:!0,expandIcon:t.jsx(ka,{}),collapseIcon:t.jsx(Fa,{}),children:Ke.map((e,a)=>t.jsx(pt.Panel,{header:e.title,itemKey:a.toString(),children:t.jsx("p",{children:e.content})},a))}):t.jsx("div",{className:"flex justify-center items-center py-8",children:t.jsx(Z,{image:t.jsx(Y,{style:{width:80,height:80}}),darkModeImage:t.jsx(J,{style:{width:80,height:80}}),title:o("暂无常见问答"),description:o("请联系管理员在系统设置中配置常见问答"),style:{padding:"12px"}})})}),t.jsx("div",{className:"card-content-fade-indicator",style:{opacity:Lt?1:0}})]})}),t.jsx(D,{...w,className:"shadow-sm !rounded-2xl lg:col-span-1",title:t.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ve,{size:16}),o("服务可用性")]}),t.jsx(xe,{icon:t.jsx(ut,{}),onClick:q,loading:Pe,size:"small",theme:"borderless",className:"text-gray-500 hover:text-blue-500 hover:bg-blue-50 !rounded-full"})]}),footer:P.length>0?t.jsx(D,{bordered:!1,className:"!rounded-2xl backdrop-blur !shadow-none",children:t.jsx("div",{className:"flex flex-wrap gap-3 text-xs justify-center",children:na.map((e,a)=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-gray-600",children:e.label})]},a))})}):null,footerStyle:P.length>0?{padding:"0px"}:void 0,children:t.jsxs("div",{className:"card-content-container",children:[t.jsx(dt,{spinning:Pe,children:t.jsx("div",{ref:ce,className:"p-2 max-h-80 overflow-y-auto card-content-scroll",onScroll:()=>he(ce,Re),children:P.length>0?P.map((e,a)=>t.jsxs("div",{className:"p-2 hover:bg-white rounded-lg transition-colors",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:Ve(e.status)}}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.name})]}),t.jsxs("span",{className:"text-xs text-gray-500",children:[((e.uptime||0)*100).toFixed(2),"%"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:ia(e.status)}),t.jsx("div",{className:"flex-1",children:t.jsx(Da,{percent:(e.uptime||0)*100,showInfo:!1,"aria-label":`${e.name} uptime`,stroke:Ve(e.status)})})]})]},a)):t.jsx("div",{className:"flex justify-center items-center py-8",children:t.jsx(Z,{image:t.jsx(Y,{style:{width:80,height:80}}),darkModeImage:t.jsx(J,{style:{width:80,height:80}}),title:o("暂无监控数据"),description:o("请联系管理员在系统设置中配置Uptime"),style:{padding:"12px"}})})})}),t.jsx("div",{className:"card-content-fade-indicator",style:{opacity:zt?1:0}})]})})]})})]})]})};export{bs as default};

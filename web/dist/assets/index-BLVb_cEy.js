import{j as a,I as kt,c as ja,d as Ft,e as Dt,f as Nt,g as Et,h as wt,i as Tt,E as Q,D as St,k as ke,l as Mt,m as ka,M as _t,F as O,S as Fa,C as q,A as Da,T as Na,n as Fe,o as Bt,p as De,q as At,r as Ea,s as It,t as $t,P as Rt}from"./semi-ui-BeeV4NSz.js";import{r as l,u as qt,R as Pt}from"./react-core-DtMAePju.js";import{l as wa,V,a as Ne}from"./visactor-C6yu58Ir.js";import{I as W,a as K}from"./IllustrationConstruction-h2fiJesH.js";import{aL as Ie,aM as Lt,aN as zt,aO as Ht,aP as oe,aQ as Ee,aR as we,aS as F,aT as Ut,aU as Qt,aV as le,aW as Ot,aX as Vt,A as Te,s as Se,aY as Me,aZ as Wt,a_ as Kt,a$ as Zt,b0 as Gt,b1 as Yt,b2 as Jt}from"./index-yYlHJgIG.js";import{u as Xt}from"./i18n-iDzTAgfN.js";import"./tools-cXdxKvEc.js";import"./react-components-XvIrFW7f.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],as=Ie("chart-pie",es);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],ss=Ie("server",ts);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],ls=Ie("wallet",os),Ta="Inter,-apple-system,BlinkMacSystemFont,Segoe UI,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Helvetica Neue,Helvetica,Arial,sans-serif",Be="theme-mode",Sa=(i,c,d)=>{const n=i&&getComputedStyle(document.body).getPropertyValue(i)||c;return n&&!isNaN(n[0])?`rgba(${n})`:n},rs=(i,c,d)=>{new MutationObserver(n=>{n.forEach(m=>{m.attributeName===c&&d(m)})}).observe(i,{attributes:!0})},ns=(i,c,d,n)=>c.map((m,o)=>{const{scheme:b}=d[o];return Object.assign(Object.assign({},m),{scheme:m.scheme.map((D,N)=>Sa(typeof D=="object"?D[i]:D,b==null?void 0:b[N]))})}),cs=(i,c,d,n)=>{const m={};return Object.keys(c).forEach(o=>{const b=typeof c[o]=="object"?c[o][i]:c[o];m[o]=Sa(b,d[o])}),m},Ma=()=>document.body.hasAttribute(Be)&&document.body.getAttribute(Be)==="dark"?"dark":"light",is=i=>`semiDesign${i[0].toUpperCase()}${i.slice(1)}`,us=i=>{new MutationObserver(c=>{c.forEach(d=>{var n;if(d.addedNodes.length===1){const m=d.addedNodes[0];m.tagName==="LINK"&&((n=m.getAttribute)===null||n===void 0?void 0:n.call(m,"semi-theme-switcher"))==="true"&&i(d,m)}})}).observe(document.body,{childList:!0})},ds={default:{dataScheme:wa.colorScheme.default.dataScheme,palette:{backgroundColor:"#16161a",borderColor:"rgba(255,255,255,0.08)",shadowColor:"rgba(0,0,0,0.25)",hoverBackgroundColor:"rgba(255,255,255,0.12)",sliderRailColor:"rgba(255,255,255,0.12)",sliderHandleColor:"#e4e7f5",sliderTrackColor:"rgba(84,169,255,1)",popupBackgroundColor:"#43444a",primaryFontColor:"rgba(249,249,249,1)",secondaryFontColor:"rgba(249,249,249,0.8)",tertiaryFontColor:"rgba(249,249,249,0.6)",axisLabelFontColor:"rgba(249,249,249,0.6)",disableFontColor:"rgba(249,249,249,0.35)",axisMarkerFontColor:"#16161a",axisGridColor:"rgba(255,255,255,0.08)",axisDomainColor:"rgba(255,255,255,0.08)",dataZoomHandleStrokeColor:"rgba(46,50,56,0.13)",dataZoomChartColor:"rgba(255,255,255,0.16)",playerControllerColor:"rgba(84,169,255,1)",axisMarkerBackgroundColor:"rgba(249,249,249,1)",markLabelBackgroundColor:"rgba(255,255,255,0.08)",markLineStrokeColor:"rgba(249,249,249,0.8)",dangerColor:"rgba(252,114,90,1)",warningColor:"rgba(255,174,67,1)",successColor:"rgba(93,194,100,1)",infoColor:"rgba(84,169,255,1)"}}},ms={name:"semiDesignDark",description:"Semi Design - dark",type:"dark",fontFamily:Ta,colorScheme:ds},hs={default:{dataScheme:wa.colorScheme.default.dataScheme,palette:{backgroundColor:"rgba(255,255,255,1)",borderColor:"rgba(28,31,35,0.08)",shadowColor:"rgba(0,0,0,0.1)",hoverBackgroundColor:"rgba(46,50,56,0.05)",sliderRailColor:"rgba(46,50,56,0.05)",sliderHandleColor:"rgba(255,255,255,1)",sliderTrackColor:"rgba(0,100,250,1)",popupBackgroundColor:"rgba(255,255,255,1)",primaryFontColor:"rgba(28,31,35,1)",secondaryFontColor:"rgba(28,31,35,0.8)",tertiaryFontColor:"rgba(28,31,35,0.62)",axisLabelFontColor:"rgba(28,31,35,0.62)",disableFontColor:"rgba(28,31,35,0.35)",axisMarkerFontColor:"rgba(255,255,255,1)",axisGridColor:"rgba(28,31,35,0.08)",axisDomainColor:"rgba(28,31,35,0.15)",dataZoomHandleStrokeColor:"rgba(46,50,56,0.13)",dataZoomChartColor:"rgba(46,50,56,0.09)",playerControllerColor:"rgba(0,100,250,1)",axisMarkerBackgroundColor:"rgba(28,31,35,1)",markLabelBackgroundColor:"rgba(28,31,35,0.08)",markLineStrokeColor:"rgba(28,31,35,0.8)",dangerColor:"rgba(249,57,32,1)",warningColor:"rgba(252,136,0,1)",successColor:"rgba(59,179,70,1)",infoColor:"rgba(0,100,250,1)"}}},gs={name:"semiDesignLight",description:"Semi Design - light",type:"light",fontFamily:Ta,colorScheme:hs},ps={backgroundColor:"--semi-color-bg-0",borderColor:"--semi-color-border",hoverBackgroundColor:"--semi-color-fill-0",sliderRailColor:"--semi-color-fill-0",sliderHandleColor:"--semi-white",sliderTrackColor:"--semi-color-primary",popupBackgroundColor:"--semi-color-bg-3",primaryFontColor:"--semi-color-text-0",secondaryFontColor:"--semi-color-text-1",tertiaryFontColor:"--semi-color-text-2",axisLabelFontColor:"--semi-color-text-0",disableFontColor:"--semi-color-disabled-text",axisMarkerFontColor:"--semi-color-bg-0",axisGridColor:"--semi-color-border",axisDomainColor:{light:"--semi-grey-9",dark:"--semi-color-border"},dataZoomHandleStrokeColor:{light:"--semi-color-fill-2"},dataZoomChartColor:"--semi-color-fill-1",playerControllerColor:"--semi-color-primary",axisMarkerBackgroundColor:"--semi-color-text-0",markLabelBackgroundColor:"--semi-color-border",markLineStrokeColor:"--semi-color-text-1",dangerColor:"--semi-color-danger",warningColor:"--semi-color-warning",successColor:"--semi-color-success",infoColor:"--semi-color-info"},xs=[{maxDomainLength:10,scheme:["--semi-color-data-0","--semi-color-data-2","--semi-color-data-4","--semi-color-data-6","--semi-color-data-8","--semi-color-data-10","--semi-color-data-12","--semi-color-data-14","--semi-color-data-16","--semi-color-data-18"]},{scheme:["--semi-color-data-0","--semi-color-data-1","--semi-color-data-2","--semi-color-data-3","--semi-color-data-4","--semi-color-data-5","--semi-color-data-6","--semi-color-data-7","--semi-color-data-8","--semi-color-data-9","--semi-color-data-10","--semi-color-data-11","--semi-color-data-12","--semi-color-data-13","--semi-color-data-14","--semi-color-data-15","--semi-color-data-16","--semi-color-data-17","--semi-color-data-18","--semi-color-data-19"]}],bs={light:gs,dark:ms},Ae=(i,c)=>{const d=bs[i],{dataScheme:n,palette:m}=d.colorScheme.default,o={default:{dataScheme:ns(i,xs,n),palette:cs(i,ps,m)}};return Object.assign(Object.assign({},d),{colorScheme:o})},fs=i=>{const{defaultMode:c,isWatchingMode:d=!0,isWatchingThemeSwitch:n=!1}=i??{};_e(!1,c),d&&rs(document.body,Be,()=>_e()),n&&us(()=>{const m=Ma(),o=JSON.stringify(Ae(m).colorScheme);let b=0;const D=setInterval(()=>{const N=Ae(m);(b>50||o!==JSON.stringify(N.colorScheme))&&(_e(!0,m,N),clearInterval(D)),b++},100)})},_e=(i,c,d)=>{c||(c=Ma());const n=is(c);(i||V.ThemeManager.getCurrentTheme()!==n)&&(i&&V.ThemeManager.removeTheme(n),V.ThemeManager.themeExist(n)||V.ThemeManager.registerTheme(n,d??Ae(c)),V.ThemeManager.setCurrentTheme(n))},Ss=i=>{var ia,ua,da,ma,ha,ga,pa,xa,ba,fa,Ca;const[c,d]=l.useContext(Lt),[n,m]=l.useContext(zt),{t:o}=Xt(),b=qt(),D=l.useRef(),N=l.useRef(!1),re=l.useRef(null),ne={mode:"desktop-browser"},w={shadows:"always",bordered:!1,headerLine:!0},_a={className:"w-full mb-2 !rounded-lg",size:"large"},$e="text-white hover:bg-opacity-80 !rounded-full",Z="flex items-center gap-2",f={width:96,height:96};let Re=new Date;const ce=Ht(),Ba=((ia=n==null?void 0:n.status)==null?void 0:ia.api_info_enabled)??!0,qe=((ua=n==null?void 0:n.status)==null?void 0:ua.announcements_enabled)??!0,Pe=((da=n==null?void 0:n.status)==null?void 0:da.faq_enabled)??!0,Le=((ma=n==null?void 0:n.status)==null?void 0:ma.uptime_kuma_enabled)??!0,ie=Ba,Aa=qe||Pe||Le,ue=l.useCallback(()=>localStorage.getItem("data_export_default_time")||"hour",[]),G=l.useCallback((e,t=!1)=>{const s={hour:t?3600:60,day:t?86400:1440,week:t?604800:10080};return s[e]||s.hour},[]),Ia=l.useCallback(()=>{const e=ue(),t=new Date().getTime()/1e3;switch(e){case"hour":return oe(t-86400);case"week":return oe(t-86400*30);default:return oe(t-86400*7)}},[ue]),T=l.useCallback((e,t,s)=>{e.has(t)||e.set(t,0),e.set(t,e.get(t)+s)},[]),ze=l.useCallback((e,...t)=>{t.forEach(s=>{s.has(e)||s.set(e,0)})},[]),de=l.useCallback((e,t,s,r,u)=>{e(h=>({...h,data:[{id:u,values:t}],title:{...h.title,subtext:s},color:{specified:r}}))},[]),P=l.useCallback((e,t)=>a.jsxs("div",{className:Z,children:[a.jsx(e,{size:16}),t]}),[]),Y=l.useCallback((e,t)=>a.jsx(e,{..._a,...t}),[]),$a=l.useMemo(()=>[{label:o("å°æ—¶"),value:"hour"},{label:o("å¤©"),value:"day"},{label:o("å‘¨"),value:"week"}],[o]),[Ra,qa]=l.useState({username:"",token_name:"",model_name:"",start_timestamp:Ia(),end_timestamp:oe(Re.getTime()/1e3+3600),channel:"",data_export_default_time:""}),[x,Pa]=l.useState(ue()),[He,Ue]=l.useState(!1),[Cs,La]=l.useState([]),[me,za]=l.useState(0),[S,Ha]=l.useState(0),[L,Ua]=l.useState(0),[Qa,Oa]=l.useState([{type:"null",value:"0"}]),[Va,Wa]=l.useState([]),[Qe,Ka]=l.useState({}),[Oe,Za]=l.useState("1"),[Ga,Ya]=l.useState(!1),[Ja,he]=l.useState(!1),[M,Xa]=l.useState({balance:[],usedQuota:[],requestCount:[],times:[],consumeQuota:[],tokens:[],rpm:[],tpm:[]}),ge=l.useRef(null),pe=l.useRef(null),xe=l.useRef(null),J=l.useRef({}),[et,Ve]=l.useState(!1),[at,We]=l.useState(!1),[Ke,X]=l.useState(!1),[y,tt]=l.useState([]),[Ze,Ge]=l.useState(!1),[j,Ye]=l.useState(""),{username:be,model_name:vs,start_timestamp:_,end_timestamp:B,channel:ys}=Ra,[st,ot]=l.useState({type:"pie",data:[{id:"id0",values:Qa}],outerRadius:.8,innerRadius:.5,padAngle:.6,valueField:"value",categoryField:"type",pie:{style:{cornerRadius:10},state:{hover:{outerRadius:.85,stroke:"#000",lineWidth:1},selected:{outerRadius:.85,stroke:"#000",lineWidth:1}}},title:{visible:!0,text:o("æ¨¡åž‹è°ƒç”¨æ¬¡æ•°å æ¯”"),subtext:`${o("æ€»è®¡")}ï¼š${Ee(L)}`},legends:{visible:!0,orient:"left"},label:{visible:!0},tooltip:{mark:{content:[{key:e=>e.type,value:e=>Ee(e.value)}]}},color:{specified:we}}),[lt,rt]=l.useState({type:"bar",data:[{id:"barData",values:Va}],xField:"Time",yField:"Usage",seriesField:"Model",stack:!0,legends:{visible:!0,selectMode:"single"},title:{visible:!0,text:o("æ¨¡åž‹æ¶ˆè€—åˆ†å¸ƒ"),subtext:`${o("æ€»è®¡")}ï¼š${F(me,2)}`},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},tooltip:{mark:{content:[{key:e=>e.Model,value:e=>F(e.rawQuota||0,4)}]},dimension:{content:[{key:e=>e.Model,value:e=>e.rawQuota||0}],updateContent:e=>{e.sort((s,r)=>r.value-s.value);let t=0;for(let s=0;s<e.length;s++){if(e[s].key=="å…¶ä»–")continue;let r=parseFloat(e[s].value);isNaN(r)&&(r=0),e[s].datum&&e[s].datum.TimeSum&&(t=e[s].datum.TimeSum),e[s].value=F(r,4)}return e.unshift({key:o("æ€»è®¡"),value:F(t,4)}),e}}},color:{specified:we}}),fe=l.useMemo(()=>{const e=(Date.parse(B)-Date.parse(_))/6e4,t=(L/e).toFixed(3),s=isNaN(S/e)?"0":(S/e).toFixed(3);return{avgRPM:t,avgTPM:s,timeDiff:e}},[L,S,B,_]),nt=l.useMemo(()=>{var r;const e=new Date().getHours();let t="";e>=5&&e<12?t=o("æ—©ä¸Šå¥½"):e>=12&&e<14?t=o("ä¸­åˆå¥½"):e>=14&&e<18?t=o("ä¸‹åˆå¥½"):t=o("æ™šä¸Šå¥½");const s=((r=c==null?void 0:c.user)==null?void 0:r.username)||"";return`ðŸ‘‹${t}ï¼Œ${s}`},[o,(ha=c==null?void 0:c.user)==null?void 0:ha.username]),ct=l.useCallback((e,t)=>({type:"line",data:[{id:"trend",values:e.map((s,r)=>({x:r,y:s}))}],xField:"x",yField:"y",height:40,width:100,axes:[{orient:"bottom",visible:!1},{orient:"left",visible:!1}],padding:0,autoFit:!1,legends:{visible:!1},tooltip:{visible:!1},crosshair:{visible:!1},line:{style:{stroke:t,lineWidth:2}},point:{visible:!1},background:{fill:"transparent"}}),[]),it=l.useMemo(()=>{var e,t,s;return[{title:P(ls,o("è´¦æˆ·æ•°æ®")),color:"bg-blue-50",items:[{title:o("å½“å‰ä½™é¢"),value:F((e=c==null?void 0:c.user)==null?void 0:e.quota),icon:a.jsx(kt,{size:"large"}),avatarColor:"blue",onClick:()=>b("/console/topup"),trendData:[],trendColor:"#3b82f6"},{title:o("åŽ†å²æ¶ˆè€—"),value:F((t=c==null?void 0:c.user)==null?void 0:t.used_quota),icon:a.jsx(ja,{size:"large"}),avatarColor:"purple",trendData:[],trendColor:"#8b5cf6"}]},{title:P(Ut,o("ä½¿ç”¨ç»Ÿè®¡")),color:"bg-green-50",items:[{title:o("è¯·æ±‚æ¬¡æ•°"),value:(s=c.user)==null?void 0:s.request_count,icon:a.jsx(Ft,{size:"large"}),avatarColor:"green",trendData:[],trendColor:"#10b981"},{title:o("ç»Ÿè®¡æ¬¡æ•°"),value:L,icon:a.jsx(Dt,{size:"large"}),avatarColor:"cyan",trendData:M.times,trendColor:"#06b6d4"}]},{title:P(Qt,o("èµ„æºæ¶ˆè€—")),color:"bg-yellow-50",items:[{title:o("ç»Ÿè®¡é¢åº¦"),value:F(me),icon:a.jsx(Nt,{size:"large"}),avatarColor:"yellow",trendData:M.consumeQuota,trendColor:"#f59e0b"},{title:o("ç»Ÿè®¡Tokens"),value:isNaN(S)?0:S,icon:a.jsx(Et,{size:"large"}),avatarColor:"pink",trendData:M.tokens,trendColor:"#ec4899"}]},{title:P(le,o("æ€§èƒ½æŒ‡æ ‡")),color:"bg-indigo-50",items:[{title:o("å¹³å‡RPM"),value:fe.avgRPM,icon:a.jsx(wt,{size:"large"}),avatarColor:"indigo",trendData:M.rpm,trendColor:"#6366f1"},{title:o("å¹³å‡TPM"),value:fe.avgTPM,icon:a.jsx(Tt,{size:"large"}),avatarColor:"orange",trendData:M.tpm,trendColor:"#f97316"}]}]},[P,o,(ga=c==null?void 0:c.user)==null?void 0:ga.quota,(pa=c==null?void 0:c.user)==null?void 0:pa.used_quota,(xa=c==null?void 0:c.user)==null?void 0:xa.request_count,L,me,S,M,fe,b]),ut=l.useCallback(async e=>{await Ot(e)&&Vt(o("å¤åˆ¶æˆåŠŸ"))},[o]),dt=l.useCallback(e=>{const s=`https://www.tcptest.cn/http/${encodeURIComponent(e)}`;window.open(s,"_blank")},[]),ee=l.useCallback((e,t)=>{if(t==="data_export_default_time"){Pa(e);return}qa(s=>({...s,[t]:e}))},[]),ae=l.useCallback(async()=>{Ue(!0);try{let e="",t=Date.parse(_)/1e3,s=Date.parse(B)/1e3;ce?e=`/api/data/?username=${be}&start_timestamp=${t}&end_timestamp=${s}&default_time=${x}`:e=`/api/data/self/?start_timestamp=${t}&end_timestamp=${s}&default_time=${x}`;const r=await Te.get(e),{success:u,message:h,data:g}=r.data;u?(La(g),g.length===0&&g.push({count:0,model_name:"æ— æ•°æ®",quota:0,created_at:Re.getTime()/1e3}),g.sort((I,$)=>I.created_at-$.created_at),ft(g)):Se(h)}finally{Ue(!1)}},[_,B,be,x,ce]),z=l.useCallback(async()=>{Ge(!0);try{const e=await Te.get("/api/uptime/status"),{success:t,message:s,data:r}=e.data;t?(tt(r||[]),r&&r.length>0&&!j&&Ye(r[0].categoryName)):Se(s)}catch(e){console.error(e)}finally{Ge(!1)}},[j]),Ce=l.useCallback(async()=>{await Promise.all([ae(),z()])},[ae,z]),mt=l.useCallback(()=>{Ce(),he(!1)},[Ce]),ht=l.useCallback(async()=>{await ae(),await z()},[ae,z]),gt=l.useCallback(()=>{he(!0)},[]),pt=l.useCallback(()=>{he(!1)},[]),Je=()=>{if(re.current){const e=re.current,t=e.scrollHeight>e.clientHeight,s=e.scrollTop+e.clientHeight>=e.scrollHeight-5;Ya(t&&!s)}},xt=()=>{Je()},H=(e,t)=>{if(e.current){const s=e.current,r=s.scrollHeight>s.clientHeight,u=s.scrollTop+s.clientHeight>=s.scrollHeight-5;t(r&&!u)}},te=(e,t)=>{H(e,t)};l.useEffect(()=>{const e=setTimeout(()=>{if(Je(),H(ge,Ve),H(pe,We),y.length===1)H(xe,X);else if(y.length>1&&j){const t=J.current[j];t&&H(t,X)}},100);return()=>clearTimeout(e)},[y,j]);const bt=async()=>{let e=await Te.get("/api/user/self");const{success:t,message:s,data:r}=e.data;t?d({type:"login",payload:r}):Se(s)},Xe=l.useCallback(e=>{const t={totalQuota:0,totalTimes:0,totalTokens:0,uniqueModels:new Set,timePoints:[],timeQuotaMap:new Map,timeTokensMap:new Map,timeCountMap:new Map};return e.forEach(s=>{t.uniqueModels.add(s.model_name),t.totalTokens+=s.token_used,t.totalQuota+=s.quota,t.totalTimes+=s.count;const r=Me(s.created_at,x);t.timePoints.includes(r)||t.timePoints.push(r),ze(r,t.timeQuotaMap,t.timeTokensMap,t.timeCountMap),T(t.timeQuotaMap,r,s.quota),T(t.timeTokensMap,r,s.token_used),T(t.timeCountMap,r,s.count)}),t.timePoints.sort(),t},[x,ze,T]),ea=l.useCallback((e,t,s,r)=>{const u=e.map(C=>t.get(C)||0),h=e.map(C=>s.get(C)||0),g=e.map(C=>r.get(C)||0),I=[],$=[];if(e.length>=2){const C=G(x);for(let R=0;R<e.length;R++)I.push(r.get(e[R])/C),$.push(s.get(e[R])/C)}return{balance:[],usedQuota:[],requestCount:[],times:g,consumeQuota:u,tokens:h,rpm:I,tpm:$}},[x,G]),aa=l.useCallback(e=>{const t={};return Array.from(e).forEach(s=>{t[s]=we[s]||Qe[s]||Wt(s)}),t},[Qe]),ta=l.useCallback(e=>{const t=new Map;return e.forEach(s=>{const r=Me(s.created_at,x),u=s.model_name,h=`${r}-${u}`;t.has(h)||t.set(h,{time:r,model:u,quota:0,count:0});const g=t.get(h);g.quota+=s.quota,g.count+=s.count}),t},[x]),sa=l.useCallback((e,t)=>{let s=Array.from(new Set([...e.values()].map(r=>r.time)));if(s.length<7){const r=Math.max(...t.map(h=>h.created_at)),u=G(x,!0);s=Array.from({length:7},(h,g)=>Me(r-(6-g)*u,x))}return s},[x,G]),ft=l.useCallback(e=>{const t=Xe(e),{totalQuota:s,totalTimes:r,totalTokens:u,uniqueModels:h,timePoints:g,timeQuotaMap:I,timeTokensMap:$,timeCountMap:C}=t,R=ea(g,I,$,C);Xa(R);const ye=aa(h);Ka(ye);const je=ta(e),va=new Map;for(let[v,p]of je)T(va,p.model,p.count);const ya=Array.from(va).map(([v,p])=>({type:v,value:p})).sort((v,p)=>p.value-v.value),yt=sa(je,e);let se=[];yt.forEach(v=>{let p=Array.from(h).map(k=>{const U=`${v}-${k}`,E=je.get(U);return{Time:v,Model:k,rawQuota:(E==null?void 0:E.quota)||0,Usage:E!=null&&E.quota?Kt(E.quota,4):0}});const jt=p.reduce((k,U)=>k+U.rawQuota,0);p.sort((k,U)=>U.rawQuota-k.rawQuota),p=p.map(k=>({...k,TimeSum:jt})),se.push(...p)}),se.sort((v,p)=>v.Time.localeCompare(p.Time)),de(ot,ya,`${o("æ€»è®¡")}ï¼š${Ee(r)}`,ye,"id0"),de(rt,se,`${o("æ€»è®¡")}ï¼š${F(s,2)}`,ye,"barData"),Oa(ya),Wa(se),za(s),Ua(r),Ha(u)},[Xe,ea,aa,ta,sa,de,T,o]),Ct=l.useMemo(()=>[{color:"grey",label:o("é»˜è®¤"),type:"default"},{color:"blue",label:o("è¿›è¡Œä¸­"),type:"ongoing"},{color:"green",label:o("æˆåŠŸ"),type:"success"},{color:"orange",label:o("è­¦å‘Š"),type:"warning"},{color:"red",label:o("å¼‚å¸¸"),type:"error"}],[o]),A=l.useMemo(()=>({1:{color:"#10b981",label:o("æ­£å¸¸"),text:o("å¯ç”¨çŽ‡")},0:{color:"#ef4444",label:o("å¼‚å¸¸"),text:o("æœ‰å¼‚å¸¸")},2:{color:"#f59e0b",label:o("é«˜å»¶è¿Ÿ"),text:o("é«˜å»¶è¿Ÿ")},3:{color:"#3b82f6",label:o("ç»´æŠ¤ä¸­"),text:o("ç»´æŠ¤ä¸­")}}),[o]),vt=l.useMemo(()=>Object.entries(A).map(([e,t])=>({status:Number(e),color:t.color,label:t.label})),[A]),ve=l.useCallback(e=>{var t;return((t=A[e])==null?void 0:t.color)||"#8b9aa7"},[A]),oa=l.useCallback(e=>{var t;return((t=A[e])==null?void 0:t.text)||o("æœªçŸ¥")},[A,o]),la=l.useMemo(()=>{var e;return((e=n==null?void 0:n.status)==null?void 0:e.api_info)||[]},[(ba=n==null?void 0:n.status)==null?void 0:ba.api_info]),ra=l.useMemo(()=>{var t;return(((t=n==null?void 0:n.status)==null?void 0:t.announcements)||[]).map(s=>({...s,time:Zt(s.publishDate)}))},[(fa=n==null?void 0:n.status)==null?void 0:fa.announcements]),na=l.useMemo(()=>{var e;return((e=n==null?void 0:n.status)==null?void 0:e.faq)||[]},[(Ca=n==null?void 0:n.status)==null?void 0:Ca.faq]),ca=l.useCallback(e=>{if(!e||e.length===0)return a.jsx("div",{className:"flex justify-center items-center py-4",children:a.jsx(Q,{image:a.jsx(W,{style:f}),darkModeImage:a.jsx(K,{style:f}),title:o("æš‚æ— ç›‘æŽ§æ•°æ®")})});const t={};e.forEach(r=>{const u=r.group||"";t[u]||(t[u]=[]),t[u].push(r)});const s=(r,u)=>a.jsxs("div",{className:"p-2 hover:bg-white rounded-lg transition-colors",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:ve(r.status)}}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:r.name})]}),a.jsxs("span",{className:"text-xs text-gray-500",children:[((r.uptime||0)*100).toFixed(2),"%"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xs text-gray-500",children:oa(r.status)}),a.jsx("div",{className:"flex-1",children:a.jsx(Rt,{percent:(r.uptime||0)*100,showInfo:!1,"aria-label":`${r.name} uptime`,stroke:ve(r.status)})})]})]},u);return Object.entries(t).map(([r,u])=>a.jsxs("div",{className:"mb-2",children:[r&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-md font-semibold text-gray-500 px-2 py-1",children:r}),a.jsx(St,{})]}),u.map(s)]},r||"default"))},[o,ve,oa]);return l.useEffect(()=>{bt(),N.current||(fs({isWatchingThemeSwitch:!0}),N.current=!0,ht())},[]),a.jsxs("div",{className:"bg-gray-50 h-full",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:nt}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(ke,{icon:a.jsx(Mt,{}),onClick:gt,className:`bg-green-500 hover:bg-green-600 ${$e}`}),a.jsx(ke,{icon:a.jsx(ka,{}),onClick:Ce,loading:He,className:`bg-blue-500 hover:bg-blue-600 ${$e}`})]})]}),a.jsx(_t,{title:o("æœç´¢æ¡ä»¶"),visible:Ja,onOk:mt,onCancel:pt,closeOnEsc:!0,size:Gt()?"full-width":"small",centered:!0,children:a.jsxs(O,{ref:D,layout:"vertical",className:"w-full",children:[Y(O.DatePicker,{field:"start_timestamp",label:o("èµ·å§‹æ—¶é—´"),initValue:_,value:_,type:"dateTime",name:"start_timestamp",onChange:e=>ee(e,"start_timestamp")}),Y(O.DatePicker,{field:"end_timestamp",label:o("ç»“æŸæ—¶é—´"),initValue:B,value:B,type:"dateTime",name:"end_timestamp",onChange:e=>ee(e,"end_timestamp")}),Y(O.Select,{field:"data_export_default_time",label:o("æ—¶é—´ç²’åº¦"),initValue:x,placeholder:o("æ—¶é—´ç²’åº¦"),name:"data_export_default_time",optionList:$a,onChange:e=>ee(e,"data_export_default_time")}),ce&&Y(O.Input,{field:"username",label:o("ç”¨æˆ·åç§°"),value:be,placeholder:o("å¯é€‰å€¼"),name:"username",onChange:e=>ee(e,"username")})]})}),a.jsxs(Fa,{spinning:He,children:[a.jsx("div",{className:"mb-4",children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:it.map((e,t)=>a.jsx(q,{...w,className:`${e.color} border-0 !rounded-2xl w-full`,title:e.title,children:a.jsx("div",{className:"space-y-4",children:e.items.map((s,r)=>a.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:s.onClick,children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Da,{className:"mr-3",size:"small",color:s.avatarColor,children:s.icon}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-500",children:s.title}),a.jsx("div",{className:"text-lg font-semibold",children:s.value})]})]}),s.trendData&&s.trendData.length>0&&a.jsx("div",{className:"w-24 h-10",children:a.jsx(Ne,{spec:ct(s.trendData,s.trendColor),option:ne})})]},r))})},t))})}),a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:`grid grid-cols-1 gap-4 ${ie?"lg:grid-cols-4":""}`,children:[a.jsx(q,{...w,className:`shadow-sm !rounded-2xl ${ie?"lg:col-span-3":""}`,title:a.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between w-full gap-3",children:[a.jsxs("div",{className:Z,children:[a.jsx(as,{size:16}),o("æ¨¡åž‹æ•°æ®åˆ†æž")]}),a.jsxs(Na,{type:"button",activeKey:Oe,onChange:Za,children:[a.jsx(Fe,{tab:a.jsxs("span",{children:[a.jsx(ja,{}),o("æ¶ˆè€—åˆ†å¸ƒ")]}),itemKey:"1"}),a.jsx(Fe,{tab:a.jsxs("span",{children:[a.jsx(Bt,{}),o("è°ƒç”¨æ¬¡æ•°åˆ†å¸ƒ")]}),itemKey:"2"})]})]}),children:a.jsx("div",{style:{height:400},children:Oe==="1"?a.jsx(Ne,{spec:lt,option:ne}):a.jsx(Ne,{spec:st,option:ne})})}),ie&&a.jsx(q,{...w,className:"bg-gray-50 border-0 !rounded-2xl",title:a.jsxs("div",{className:Z,children:[a.jsx(ss,{size:16}),o("APIä¿¡æ¯")]}),children:a.jsxs("div",{className:"card-content-container",children:[a.jsx("div",{ref:re,className:"space-y-3 max-h-96 overflow-y-auto card-content-scroll",onScroll:xt,children:la.length>0?la.map(e=>a.jsxs("div",{className:"flex p-2 hover:bg-white rounded-lg transition-colors cursor-pointer",children:[a.jsx("div",{className:"flex-shrink-0 mr-3",children:a.jsx(Da,{size:"extra-small",color:e.color,children:e.route.substring(0,2)})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1 !font-bold flex items-center gap-2",children:[a.jsx(De,{prefixIcon:a.jsx(le,{size:12}),size:"small",color:"white",shape:"circle",onClick:()=>dt(e.url),className:"cursor-pointer hover:opacity-80 text-xs",children:o("æµ‹é€Ÿ")}),e.route]}),a.jsx("div",{className:"!text-semi-color-primary break-all cursor-pointer hover:underline mb-1",onClick:()=>ut(e.url),children:e.url}),a.jsx("div",{className:"text-gray-500",children:e.description})]})]},e.id)):a.jsx("div",{className:"flex justify-center items-center py-8",children:a.jsx(Q,{image:a.jsx(W,{style:f}),darkModeImage:a.jsx(K,{style:f}),title:o("æš‚æ— APIä¿¡æ¯"),description:o("è¯·è”ç³»ç®¡ç†å‘˜åœ¨ç³»ç»Ÿè®¾ç½®ä¸­é…ç½®APIä¿¡æ¯")})})}),a.jsx("div",{className:"card-content-fade-indicator",style:{opacity:Ga?1:0}})]})})]})}),Aa&&a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[qe&&a.jsx(q,{...w,className:"shadow-sm !rounded-2xl lg:col-span-2",title:a.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-2 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Yt,{size:16}),o("ç³»ç»Ÿå…¬å‘Š"),a.jsx(De,{size:"small",color:"grey",shape:"circle",children:o("æ˜¾ç¤ºæœ€æ–°20æ¡")})]}),a.jsx("div",{className:"flex flex-wrap gap-3 text-xs",children:Ct.map((e,t)=>a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color==="grey"?"#8b9aa7":e.color==="blue"?"#3b82f6":e.color==="green"?"#10b981":e.color==="orange"?"#f59e0b":e.color==="red"?"#ef4444":"#8b9aa7"}}),a.jsx("span",{className:"text-gray-600",children:e.label})]},t))})]}),children:a.jsxs("div",{className:"card-content-container",children:[a.jsx("div",{ref:ge,className:"p-2 max-h-96 overflow-y-auto card-content-scroll",onScroll:()=>te(ge,Ve),children:ra.length>0?a.jsx(At,{mode:"alternate",dataSource:ra}):a.jsx("div",{className:"flex justify-center items-center py-8",children:a.jsx(Q,{image:a.jsx(W,{style:f}),darkModeImage:a.jsx(K,{style:f}),title:o("æš‚æ— ç³»ç»Ÿå…¬å‘Š"),description:o("è¯·è”ç³»ç®¡ç†å‘˜åœ¨ç³»ç»Ÿè®¾ç½®ä¸­é…ç½®å…¬å‘Šä¿¡æ¯")})})}),a.jsx("div",{className:"card-content-fade-indicator",style:{opacity:et?1:0}})]})}),Pe&&a.jsx(q,{...w,className:"shadow-sm !rounded-2xl lg:col-span-1",title:a.jsxs("div",{className:Z,children:[a.jsx(Jt,{size:16}),o("å¸¸è§é—®ç­”")]}),bodyStyle:{padding:0},children:a.jsxs("div",{className:"card-content-container",children:[a.jsx("div",{ref:pe,className:"p-2 max-h-96 overflow-y-auto card-content-scroll",onScroll:()=>te(pe,We),children:na.length>0?a.jsx(Ea,{accordion:!0,expandIcon:a.jsx(It,{}),collapseIcon:a.jsx($t,{}),children:na.map((e,t)=>a.jsx(Ea.Panel,{header:e.question,itemKey:t.toString(),children:a.jsx("p",{children:e.answer})},t))}):a.jsx("div",{className:"flex justify-center items-center py-8",children:a.jsx(Q,{image:a.jsx(W,{style:f}),darkModeImage:a.jsx(K,{style:f}),title:o("æš‚æ— å¸¸è§é—®ç­”"),description:o("è¯·è”ç³»ç®¡ç†å‘˜åœ¨ç³»ç»Ÿè®¾ç½®ä¸­é…ç½®å¸¸è§é—®ç­”")})})}),a.jsx("div",{className:"card-content-fade-indicator",style:{opacity:at?1:0}})]})}),Le&&a.jsxs(q,{...w,className:"shadow-sm !rounded-2xl lg:col-span-1 flex flex-col",title:a.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(le,{size:16}),o("æœåŠ¡å¯ç”¨æ€§")]}),a.jsx(ke,{icon:a.jsx(ka,{}),onClick:z,loading:Ze,size:"small",theme:"borderless",className:"text-gray-500 hover:text-blue-500 hover:bg-blue-50 !rounded-full"})]}),bodyStyle:{padding:0},children:[a.jsx("div",{className:"flex-1 relative",children:a.jsx(Fa,{spinning:Ze,children:y.length>0?y.length===1?a.jsxs("div",{className:"card-content-container",children:[a.jsx("div",{ref:xe,className:"p-2 max-h-[24rem] overflow-y-auto card-content-scroll",onScroll:()=>te(xe,X),children:ca(y[0].monitors)}),a.jsx("div",{className:"card-content-fade-indicator",style:{opacity:Ke?1:0}})]}):a.jsx(Na,{type:"card",collapsible:!0,activeKey:j,onChange:Ye,size:"small",children:y.map((e,t)=>{J.current[e.categoryName]||(J.current[e.categoryName]=Pt.createRef());const s=J.current[e.categoryName];return a.jsx(Fe,{tab:a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(le,{size:14}),e.categoryName,a.jsx(De,{color:j===e.categoryName?"red":"grey",size:"small",shape:"circle",children:e.monitors?e.monitors.length:0})]}),itemKey:e.categoryName,children:a.jsxs("div",{className:"card-content-container",children:[a.jsx("div",{ref:s,className:"p-2 max-h-[21.5rem] overflow-y-auto card-content-scroll",onScroll:()=>te(s,X),children:ca(e.monitors)}),a.jsx("div",{className:"card-content-fade-indicator",style:{opacity:j===e.categoryName&&Ke?1:0}})]})},t)})}):a.jsx("div",{className:"flex justify-center items-center py-8",children:a.jsx(Q,{image:a.jsx(W,{style:f}),darkModeImage:a.jsx(K,{style:f}),title:o("æš‚æ— ç›‘æŽ§æ•°æ®"),description:o("è¯·è”ç³»ç®¡ç†å‘˜åœ¨ç³»ç»Ÿè®¾ç½®ä¸­é…ç½®Uptime")})})})}),y.length>0&&a.jsx("div",{className:"p-3 mt-auto bg-gray-50 rounded-b-2xl",children:a.jsx("div",{className:"flex flex-wrap gap-3 text-xs justify-center",children:vt.map((e,t)=>a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),a.jsx("span",{className:"text-gray-600",children:e.label})]},t))})})]})]})})]})]})};export{Ss as default};
